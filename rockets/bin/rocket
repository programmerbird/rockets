#!/bin/bash

ROCKETDIR=`pwd`
REQUIREMENTS="""
Django==1.1.1
Fabric==0.9.0
zope.interface==3.5.3
-e svn+https://svn.apache.org/repos/asf/incubator/libcloud/trunk@921044#egg=apache_libcloud-0.3.0-py2.6-dev_r921044
-e git+http://github.com/ssimasanti/rockets.git#egg=Rockets
"""

while [ ! -d "$ROCKETDIR/.rockets" ] 
do
	if [ "$ROCKETDIR" == "/" ]
	then
		ROCKETDIR=""
		break 
	fi
	ROCKETDIR=$(dirname "$ROCKETDIR")
done


if [ -z $ROCKETDIR ]
then
	if [ "$1" == "init" ]
	then
		ROCKETDIR=`pwd`
		virtualenv --no-site-packages .rockets
	else
		echo "fatal: Not a rocket (or any of the parent directories): .rockets"
		exit 1
	fi
fi

if [ "$1" == "init" ]
then
	for X in $REQUIREMENTS
	do
		$ROCKETDIR/.rockets/bin/pip install "$X"
	done
	$ROCKETDIR/.rockets/bin/python -m rockets.servers.bootstrap "$ROCKETDIR"
	$ROCKETDIR/.rockets/bin/python $ROCKETDIR/manage.py syncdb 
else
	$ROCKETDIR/.rockets/bin/python $ROCKETDIR/manage.py $1 $2 $3 $4 $5 $6 $7 $8 $9
fi

