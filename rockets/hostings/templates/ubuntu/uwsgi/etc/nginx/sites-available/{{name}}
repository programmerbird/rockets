
server { 
	listen       80;
	{% if domains %}
	server_name  {% for domain in domains %} {{domain}}{% endfor %};
	{% endif %}

	# main access log
	access_log  /var/log/uwsgi/{{name}}.access main;
	error_log  /var/log/uwsgi/{{name}}.error info;
	
	root /home/{{name}}/app{{secret}};
	
	client_max_body_size 50m;
    
	location /media {
		root /home/{{name}}/app{{secret}}/media;
	}
	
	location ~* ^/media/.+\.(mpg|avi|mp3|swf|zip|tgz|gz|rar|bz2|doc|xls|exe|ppt|txt|tar|mid|midi|wav|rtf|mpeg)$ {
		access_log off;
		break;
	}

	location ~* ^/media/.+\.(jpg|jpeg|gif|png|ico|css|bmp|js)$ {
		access_log off;
		expires 30d;
		break;
	}

	location ~* ^/favicon\.(ico)$ {
		access_log off;
		expires 30d;
		break;
	}

	location  / {
		#client_body_buffer_size 50;
		uwsgi_pass unix:///tmp/uwsgi-{{name}}.sock;
		include /etc/uwsgi/nginx/uwsgi_params;
	}
	
	
}

